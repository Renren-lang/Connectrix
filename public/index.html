<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Connectrix - Connecting Students & Alumni for Growth and Mentorship"
    />
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin" />
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="unsafe-none" />
    <meta http-equiv="Cross-Origin-Resource-Policy" content="cross-origin" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="cache-buster" content="20250118-1400" />
    <meta name="version" content="2.0.0" />
    <meta name="build-time" content="2025-01-18T14:00:00Z" />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
      /* Fallback for Font Awesome icons */
      .fas, .far, .fab {
        font-family: "Font Awesome 6 Free", "Font Awesome 6 Pro", "Font Awesome 6 Brands" !important;
        font-weight: 900;
      }
      .far {
        font-weight: 400;
      }
    </style>
    <title>Connectrix </title>
    <script>
      // Smart syntax error detection - only clear cache when there's actually an error
      (function() {
        let hasSyntaxError = false;
        let checkCount = 0;
        const maxChecks = 3; // Only check 3 times to avoid infinite loops
        
        const checkScripts = function() {
          if (hasSyntaxError || checkCount >= maxChecks) return;
          checkCount++;
          
          const scripts = document.querySelectorAll('script[src*=".js"]');
          let foundHtmlInJs = false;
          
          scripts.forEach(function(script) {
            if (script.src && !foundHtmlInJs) {
              fetch(script.src, {cache: 'no-cache'})
                .then(response => response.text())
                .then(text => {
                  if (text.trim().startsWith('<!DOCTYPE') || text.trim().startsWith('<html')) {
                    console.error('CRITICAL: JavaScript file contains HTML!', script.src);
                    console.error('This indicates a severe caching issue.');
                    foundHtmlInJs = true;
                    hasSyntaxError = true;
                    
                    // Only clear cache if we actually found HTML in JS
                    console.log('Clearing cache due to HTML in JavaScript file...');
                    
                    if ('caches' in window) {
                      caches.keys().then(names => {
                        names.forEach(name => caches.delete(name));
                      });
                    }
                    
                    // Force reload with cache bypass
                    setTimeout(function() {
                      window.location.href = window.location.href.split('?')[0] + '?v=' + Date.now();
                    }, 1000);
                  }
                })
                .catch(err => {
                  console.warn('Could not check script content:', err);
                });
            }
          });
        };
        
        // Only run check if there are syntax errors in console
        setTimeout(function() {
          const hasErrors = document.querySelector('.console-message-text') && 
                           document.querySelector('.console-message-text').textContent.includes('Unexpected token');
          
          if (hasErrors) {
            console.log('Syntax errors detected, checking for HTML in JS files...');
            checkScripts();
          } else {
            console.log('No syntax errors detected, skipping cache check.');
          }
        }, 2000); // Wait 2 seconds to see if errors appear
      })();
    </script>
    <script>
      // Smart error handling - only clear cache when there's a real syntax error
      let syntaxErrorCount = 0;
      window.addEventListener('error', function(e) {
        console.error('JavaScript error detected:', e);
        
        if (e.message && e.message.includes('Unexpected token')) {
          syntaxErrorCount++;
          console.error('Syntax error detected - likely caching issue:', e);
          console.error('Error details:', {
            message: e.message,
            filename: e.filename,
            lineno: e.lineno,
            colno: e.colno,
            timestamp: new Date().toISOString(),
            errorCount: syntaxErrorCount
          });
          
          // Only clear cache if we have multiple syntax errors (indicating real problem)
          if (syntaxErrorCount >= 2) {
            console.log('Multiple syntax errors detected, clearing cache and reloading...');
            
            // Clear all caches
            if ('caches' in window) {
              caches.keys().then(function(names) {
                names.forEach(function(name) {
                  caches.delete(name);
                });
              });
            }
            
            // Force reload with cache bypass
            setTimeout(function() {
              window.location.href = window.location.href.split('?')[0] + '?v=' + Date.now();
            }, 2000);
          } else {
            console.log('Single syntax error detected, will monitor for more errors...');
          }
        }
      });
      
      // Additional check for HTML content in JS files
      window.addEventListener('load', function() {
        // Check if any script tags are loading HTML instead of JS
        const scripts = document.querySelectorAll('script[src]');
        scripts.forEach(function(script) {
          if (script.src && script.src.includes('.js')) {
            fetch(script.src)
              .then(response => response.text())
              .then(text => {
                if (text.trim().startsWith('<!DOCTYPE') || text.trim().startsWith('<html')) {
                  console.error('Script file contains HTML instead of JavaScript:', script.src);
                  console.error('This indicates a server configuration issue or caching problem');
                  alert('A script file is loading HTML instead of JavaScript. This usually indicates a caching issue. Please refresh the page.');
                }
              })
              .catch(error => {
                console.error('Error checking script content:', error);
              });
          }
        });
      });
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>
